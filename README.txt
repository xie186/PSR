Last updated on: 02/09/2015
PSR (Polymorphic SSR Retrieval ) user manual.

The following inaccuracies were fixed in this version:

- The DESTROY object method for Bio::DB::Sam instance has been deprecated in PSR_read_retrieval.pl
- In PSR_poly_finder.pl script the mysql user, named psr, writes the query result on server host by setting FILE privilege, then the file is moved to the folder of user's choice.


Contents:
1.	LICENSE
2.	OBTAINING PSR
3.	REQUIREMENTS
4.	INSTALLATION 
5.	INPUT FILES 
6.	RUNNING PSR 
7.	OUTPUT FILES 


########################################################################################
1. LICENSE 
PSR is a computational tool to identify polymorphic microsatellites from NGS data.

This program is free: you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details. You should have received a copy of the GNU General Public License along with this program. If not, see http://www.gnu.org/licenses/.

AUTHORS:
Concita Cantarella
Nunzio D'Agostino

Contact:
concita.cantarella@gmail.com
nunzio.dagostino@entecra.it

Reference: 
PSR: polymorphic SSR retrieval. Cantarella C., D'Agostino N. BMC Research Notes 2015, 8:525 doi:10.1186/s13104-015-1474-4


########################################################################################
2. OBTAINING PSR
PSR is an open source program that can be freely downloaded from:
https://sourceforge.net/projects/polyssr/


########################################################################################
3. REQUIREMENTS
PSR has been completely developed using Perl v5.10.1. In order to run PSR, prior installation of Perl (5.10 or higher version) and MYSQL (5.5.23 or higher version) are required. Although PSR has been developed on Unix systems, it is compatible with all Unix and MS Windows based operating systems.
Mandatory Perl modules:
Text::CSV
Bio::DB::Sam
DBD::SQLite
Module::Build
File:Which
Math::Random
SOAP::Lite
Sort::Naturally
Array::Compare
DBI
DBD::mysql


Mandatory 
SAMtools available at http://samtools.sourceforge.net (If an error occurs during installation try to add option –fPIC for CFLAGS in Makefile and Makefile.mingw)


The follow command line allows to install older and stable version of required Bio::DB::Sam module.
$ cpanm Bio::DB::Sam~">= 1.38, < 1.41"

########################################################################################
4. INSTALLATION 
PSR is run directly using source files so it does not need to be configured with system. Simple unpacking of the downloaded files will be sufficient in order to complete the installation step. 

4.1 Unpacking: 
For Unix: tar -xvzf psr.tar.gz  
For Windows based systems: psr.zip can be unpacked using Winzip or Winrar utilities. 

4.2 Directory structure 
Unpacking of PSR will result in the main program directory.
Directory structure and package distribution is as follows:
-scripts folder
-README file
-LICENSE file


--------MANDATORY--------

	It is need special privileges to create or to delete a MySQL database. So assuming you have access to the root user, before running PSR scripts, you have to create a new database named 'PSR_DB' and a new mysql user named 'psr' able to read and write tables in PSR_DB and having FILE privileges.
	You could access the MySQL shell and typing the following command into terminal
	mysql> CREATE DATABASE PSR_DB
	mysql> GRANT ALL PRIVILEGES ON PSR_DB.* To 'psr'@'localhost';
	mysql> GRANT FILE ON *.* TO 'psr'@'localhost';

########################################################################################
5. INPUT FILES
(a.) PSR_read_retrieval.pl
	1) Tab delimited file with 7 columns. It is a MISA-like output file (http://pgrc.ipk-gatersleben.de/misa/misa.html) which includes:
		ID		SSR nr.		SSR type	SSR	size	start	end
		transcript1	1		p3		(AGG)5	15	3967	3981
		transcript1	2		p1		(T)13	13	4968	4982
		transcript2	1		p2		(AC)7	14	11452	11465

 	2) BAM file storing read alignments against reference sequences for each genotype under investigation

	At the moment, with this PSR version, we suggest to use bowtie2 as mapping alignment tool.
	The option --very-sensitive and --end-to-end mode could be used to set the entire read alignment (expecially SSR flanking region) and no mismatches.
	The option -a searches for and reports all alignments position for each read.


(b.) PSR_poly_finder.pl
	1) One PSR_counts.txt file for each sample. This file is generated by PSR_read_retrieval.pl.


########################################################################################
6. RUNNING PSR
PSR is a standalone command line program that is run either using shell (on Unix system) or command prompt/DOS (on Windows system). 

Command line:

perl PSR_read_retrieval.pl -m <tab-separeted file> -d <directory with BAM > -o <output directory> [-t minimum read depth] [-p polymorphism percentage depth]
	
Where:
-m	File storing the localization and type of the identified microsatellites ( see PSR_read_retrieval.pl INPUT file)

-d	The directory containing one or more bam files resulting from read alignment versus reference sequences

-o	A directory where all the output files will be written. To create a new directory on Unix based systems: mkdir <new_directory_name>

-t	Minimum read depth

-p	Minimum supporting reads (% of aligning reads) at a position to call variants


perl PSR_poly_finder.pl -i <input folder> -o <output directory >
	
Where:
-i	The directory containing PSR_counts.txt files.

-o	A directory where output files will be written.


########################################################################################
7. OUTPUT FILES 
(a.) PSR_read_retrieval.pl
	PSR_counts.txt 
	Object		SSR	start	stop	# repeat unit	# reads
	transcript1	(AG)8	502	517		8	   150
	transcript1	(AG)8	502	517		9	   74
	transcript2	(T)16	542	557		12	   1000
	transcript3	(T)12	550	561		13	   423

(b.) PSR_poly_finder.pl
	PSR_polySSR_date.txt
	Seq_ID		SSR	start	stop	sample1		sample2
	transcript1	(TC)8	1064	1079	5		0
	transcript2	(TC)8	1052	1067	8		0
	transcript3	(A)10	282	291	10		10
	transcript4	(TTC)6	32	49	6;4		5

	PSR_polySSR_date.txt is a tab delimited file written in /tmp/ folder or a folder selected by the user via commandline. 
	In order to build the resulting table, the PSR_poly_finder.pl script creates several mysql temporary tables, two for each sample, and one overall table. 

